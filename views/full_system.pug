extends layout

block extrahead
  script(src="javascripts/full_system.js", type="text/javascript")
  script(src="javascripts/highcharts.js", type="text/javascript")
  link(href="stylesheets/full_system.css", rel="stylesheet")
  link(href="stylesheets/highcharts.css", rel="stylesheet")


block content
  div.main-container
    div.readingbox.modalbox#readingbox(style="display:none")
      div.row.modal_content
        div.main_container
          strong Reading detail: &nbsp;
          span#detail_reading_name
            span.btn.top-right(onclick="$('#readingbox').css('display', 'none')") &times;
          br
          form#update_reading_form
            label(for="reading_desc") Description &nbsp;
            input(type="text" id="reading_desc" name="reading_desc")
            br
            label(for="reading_status") Active &nbsp;
            input(type="checkbox" id="reading_status" name="reading_status")
            br
            label(for="readout_interval") Readout interval &nbsp;
            input(type="number" id="readout_interval" name="readout_interval" min="0.1" max="3600" size=3 width=3)
            br
            label(for="runmode") Runmode: &nbsp;
            select(id="runmode" name="runmode")
              option(value="testing") testing
              option(value="default") default
            br
            label(for="alarms") Alarms:
            // TODO this will probably be a bit awkward
            br
            button.btn.btn-info(onclick="UpdateReading()") Update reading
          br
          div.main_container.chart_header
            strong Recent history &nbsp; &nbsp;
            label(for="reading_history") History &nbsp;
            input#reading_history(type="range" onchange="RangeSliders()" min=0 max=9 value=1 style="width:100px")
            label(for="reading_binning") Binning &nbsp;
            input#reading_binning(type="range" onchange="RangeSliders()" min=0 max=5 value=1 style="width:100px")
            button.btn.btn-info#get_data(onclick="DrawReadingHistory()") Update plot
            button.btn.btn-info(onclick="$('#readingbox').css('display', 'none')") Close
          div.main_container.reading_chart#reading_chart

    div.sensorbox.modalbox#sensorbox(style="display:none")
      div.row.modal_content(style="padding:5px")
        div.main_container
          strong Sensor detail: &nbsp;
          span#detail_sensor_name
          span.btn.top-right(onclick="$('#sensorbox').css('display','none')") &times;
          br
          form#update_sensor_form
            fieldset#sensor_eth
              label(for="sensor_ip") IP &nbsp
              input(type="text" id="sensor_ip" name="sensor_ip" pattern="^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$")
              span &nbsp; &nbsp; &nbsp;
              label(for="sensor_port") Port &nbsp
              input(type="number" id="sensor_port" name="sensor_port" min="1025" max="65535" step="1")
            fieldset#sensor_serial
              label(for="sensor_tty") TTY 
              input(type="text" id="sensor_tty" name="sensor_tty")
              span &nbsp; &nbsp; &nbsp;
              label(for="sensor_baud") Baud 
              select(id="sensor_baud" name="sensor_baud")
                option(value="9600") 9600
                option(value="19200") 19,200
              span &nbsp; &nbsp; &nbsp;
              label(for="sensor_serial_id") SerialID 
              input(type="text" id="sensor_serial_id" name="sensor_serial_id")
            button.btn.btn-info(onclick="UpdateSensor()") Update
            span &nbsp; &nbsp;
            button.btn.btn-info(onclick="$('#sensorbox').css('display','none')") Close

    each sensor in all_readings
      div.sensor_div
        table(id=`${sensor._id}_tab` style="width:90%;border:2px solid #ccc;")
          tr(onclick=`SensorDropdown('${sensor._id}')`)
            th #{sensor._id}
            th(id=`${sensor._id}_status`) Unknown
            th &nbsp;
          each reading in sensor['readings']
            tr(onclick=`ReadingDropdown('${reading.name}')`)
              th #{reading.desc} (#{reading.name})
              td(id=`${reading.name}_status`) Unknown
              td(id=`${reading.name}_value`) -


  script.
    $(document).ready(function () {
      PopulateReadings();
    });
    window.onclick = function(event) {
      if (event.target == document.getElementById("readingbox")) event.target.style.display = 'none';
      if (event.target == document.getElementById("sensorbox")) event.target.style.display = 'none';
    }
